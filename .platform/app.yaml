# .platform/app.yaml
name: php-backend
type: 'php:8.2'
disk: 512

source:
  root: backend

build:
  flavor: composer

runtime:
  extensions:
    - sodium

web:
  locations:
    "/":
      root: "public"
      index: ["index.php"]
      passthru: "/index.php"
      scripts: true
      allow: true

mounts:
  "/var": "shared:files"

hooks:
  build: |
    set -e
    composer install --no-dev --prefer-dist --no-progress --no-interaction --optimize-autoloader

dependencies:
  php:
    composer/composer: "^2"

relationships:
  # nom de la relation = database
  database: "mysql:mysql"

variables:
  env:
    # On reconstruit DATABASE_URL en TCP (pas socket UNIX) :
    DATABASE_URL: >-
      mysql://${styx}:${styxpass}
      @tcp(${localhost}:${3309})/${styxdb}
      ?serverVersion=11.0
